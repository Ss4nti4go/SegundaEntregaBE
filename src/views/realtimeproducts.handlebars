<script src="/socket.io/socket.io.js"></script>
<h1>Lista de Productos</h1>

<ul id="productList" class="product-list">
  <!-- Los productos serán insertados aquí dinámicamente -->
</ul>
<section class="forms-container">


<!-- Formulario para agregar nuevos productos -->
<div class="product-form">
  <h2>Agregar un nuevo producto</h2>
  <input  type="text" id="productTitle" placeholder="Título" />
  <input type="text" id="productDescription" placeholder="Descripción" />
  <input type="text" id="productCode" placeholder="Código" />
  <input type="number" id="productPrice" placeholder="Precio" />
  <div class="product-status"> Estado<input type="checkbox" id="productStatus" />  </div>
  <input type="number" id="productStock" placeholder="Stock" />
  <input type="text" id="productCategory" placeholder="Categoría" />
  <input type="text" id="productThumbnail1" placeholder="Thumbnail 1" />
  <input type="text" id="productThumbnail2" placeholder="Thumbnail 2" />
  <button onclick="addProduct()">Agregar Producto</button>
</div>

<div class="product-form-delete">
  <h2>Eliminar un producto</h2>
  <input type="text" id="productId" placeholder="ID del producto" />
  <button onclick="deleteProduct()">Eliminar Producto</button>
</div>
</section>
<script>
  const socket = io();
   const idInput = document.getElementById('productId');
  // Escuchar cuando se actualiza la lista de productos
 
    socket.on('updateProducts', async () => {
      const productList = document.getElementById('productList');
      const productos = await fetch('/api/products').then(response => response.json());
      console.log(productos);
      productList.innerHTML = ''; // Limpiar la lista antes de agregar los productos actualizados

      productos.forEach(producto => {
        const li = document.createElement('li');
        li.classList.add('product-card');
        li.innerHTML = `
          <strong>${producto.title}</strong> - $${producto.price} <br>
          <small>${producto.description}</small><br>
          Código: ${producto.code} <br>
          Estado: ${producto.status} <br>
          Stock: ${producto.stock} <br>
          Categoría: ${producto.category} <br>
          <div>
            ${producto.thumbnails.map(thumbnail => `<img src="${thumbnail}" alt="Thumbnail de ${producto.title}" width="100" height="100">`).join('')}
          </div>
           ID: ${producto.id}
        `;
        productList.appendChild(li);
      });
    });
    function addProduct() {
    const title = document.getElementById('productTitle').value;
    const description = document.getElementById('productDescription').value;
    const code = document.getElementById('productCode').value;
    const price = document.getElementById('productPrice').value;
    const status = document.getElementById('productStatus').checked;
    const stock = document.getElementById('productStock').value;
    const category = document.getElementById('productCategory').value;
    const thumbnails = [
      document.getElementById('productThumbnail1').value,
      document.getElementById('productThumbnail2').value
    ];

    socket.emit('newProduct', { title, description, code, price, status, stock, category, thumbnails });
  }

  function deleteProduct() {
    socket.emit('deleteProduct', { id: idInput.value });
  }
</script>
